<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lost / LISTEN</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

  <style>
    :root{
      --bg:#f4f4f4;
      --ink:#111;
      --dim:#ccc;
      --accent:#ff3300;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;
      height:100vh;
      width:100vw;
      overflow:hidden;
      cursor:none;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    #record-layer{
      position:absolute;
      inset:0;
      z-index:0;
      pointer-events:none;
      opacity:0.5;
    }

    #crosshair-x{
      position:fixed;
      top:0; bottom:0;
      width:1px;
      background:var(--accent);
      pointer-events:none;
      z-index:1000;
      left:50%;
    }
    #crosshair-y{
      position:fixed;
      left:0; right:0;
      height:1px;
      background:var(--accent);
      pointer-events:none;
      z-index:1000;
      top:50%;
    }

    .frame{
      position:relative;
      z-index:10;
      width:94vw;
      height:90vh;
      border:1px solid var(--ink);
      display:grid;
      grid-template-columns:300px 1fr;
      grid-template-rows:60px 1fr 60px;
      background:transparent;
    }

    .playlist-col{
      grid-row:2;
      display:flex;
      flex-direction:column;
      overflow:hidden;
      background:rgba(244,244,244,0.95);
    }
    .playlist-left{
      grid-column:1;
      border-right:1px solid var(--ink);
    }

    .playlist-header{
      padding:15px;
      font-size:10px;
      border-bottom:1px solid var(--ink);
      color:var(--accent);
      letter-spacing:0.12em;
    }

    .track-list{
      flex:1;
      overflow-y:auto;
      scrollbar-width:thin;
      scrollbar-color:var(--ink) transparent;
    }
    .track-list::-webkit-scrollbar{ width:2px; }
    .track-list::-webkit-scrollbar-thumb{ background:var(--ink); }

    .track{
      padding:12px 15px;
      border-bottom:1px solid var(--dim);
      font-size:11px;
      transition:background-color 0.2s, color 0.2s;
    }
    .track:hover{
      background:var(--ink);
      color:var(--bg);
    }
    .track.active{
      background:var(--ink);
      color:var(--bg);
      font-weight:bold;
    }

    .record-col{
      grid-column:2;
      grid-row:2;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      position:relative;
      overflow:hidden;
    }

    .corner-notes{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:20;
    }
    .corner-note{
      position:absolute;
      width:28%;
      max-width:280px;
      font-size:11px;
      line-height:1.45;
      letter-spacing:0.03em;
      color:var(--ink);
      opacity:0.85;
      text-transform:none;
      transition:opacity 260ms ease;
    }
    .corner-note.off{ opacity:0; }

    .corner-note.tl{ top:78px; left:14px; text-align:left; }
    .corner-note.tr{ top:78px; right:14px; text-align:right; }
    .corner-note.bl{ bottom:72px; left:14px; text-align:left; }
    .corner-note.br{ bottom:72px; right:14px; text-align:right; }

    .header{
      grid-column:1 / -1;
      grid-row:1;
      border-bottom:1px solid var(--ink);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 20px;
      font-size:11px;
      letter-spacing:0.2em;
      background:rgba(244,244,244,0.95);
    }

    .footer{
      grid-column:1 / -1;
      grid-row:3;
      border-top:1px solid var(--ink);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 20px;
      font-size:11px;
      background:rgba(244,244,244,0.95);
    }

    #exit-btn{
      font-size:11px;
      letter-spacing:0.1em;
      border:1px solid var(--ink);
      padding:10px 20px;
      text-decoration:none;
      color:var(--ink);
      background:var(--bg);
      transition:background-color 0.2s, color 0.2s, border-color 0.2s;
    }
    #exit-btn:hover{
      background:var(--accent);
      color:#fff;
      border-color:var(--accent);
    }

    #overlay{
      position:fixed;
      inset:0;
      background:var(--bg);
      z-index:2000;
      display:flex;
      align-items:center;
      justify-content:center;
      letter-spacing:0.18em;
      text-transform:uppercase;
    }
    .overlay-wrap{
      border:1px solid var(--ink);
      padding:22px 26px;
      background:rgba(244,244,244,0.9);
      text-align:center;
      max-width:min(560px, 92vw);
    }
    .overlay-main{
      font-size:11px;
      line-height:1.5;
    }
    .overlay-sub{
      margin-top:10px;
      font-family:"Courier New", monospace;
      font-size:10px;
      letter-spacing:0.22em;
      opacity:0.65;
    }
  </style>
</head>
<body>
  <audio id="audio" loop></audio>
  <div id="crosshair-x"></div>
  <div id="crosshair-y"></div>
  <div id="record-layer"></div>

  <div id="overlay">
    <div class="overlay-wrap">
      <div class="overlay-main">
        Some music..
      </div>
      <div class="overlay-sub">
        click to listen
      </div>
    </div>
  </div>

  <div class="frame">
    <div class="header">
      <span>TURNTABLE</span>
      <span id="time-display">00:00</span>
    </div>

    <div class="playlist-col playlist-left">
      <div class="playlist-header">ARCHIVE_A</div>
      <div class="track-list">
        <div class="track" data-src="assets/uoon.mp3"><span>01 Alva Noto & Ryuichi Sakamoto · Uoon I</span></div>
        <div class="track" data-src="assets/luvsic.mp3"><span>02 Nujabes · Luv(sic) Part 2</span></div>
        <div class="track" data-src="assets/feather.mp3"><span>03 Nujabes · Feather</span></div>
        <div class="track" data-src="assets/runaway.mp3"><span>04 (Kan...)Ye... · Runaway</span></div>
        <div class="track" data-src="assets/good_news.mp3"><span>05 Unknown · Good News</span></div>
        <div class="track" data-src="assets/chocolate.mp3"><span>06 The 1975 · Chocolate</span></div>
        <div class="track" data-src="assets/in_the_middle.mp3"><span>07 Yerin Baek · in the middle</span></div>
        <div class="track" data-src="assets/do_mar.mp3"><span>08 Sora · A Caminho Do Mar</span></div>
        <div class="track" data-src="assets/yukon.mp3"><span>09 Justin Bieber · Yukon</span></div>
        <div class="track" data-src="assets/neyo.mp3"><span>10 Ne-Yo · Because of You</span></div>
        <div class="track" data-src="assets/thinkin_about.mp3"><span>11 Frank Ocean · Thinking Bout You</span></div>
        <div class="track" data-src="assets/one_day.mp3"><span>12 Uyama Hiroto · One Day</span></div>
        <div class="track" data-src="assets/transmitting_tonight.mp3"><span>13 Tim Hecker · I'm Transmitting Tonight</span></div>
        <div class="track" data-src="assets/dive.mp3"><span>14 Olivia Dean · Dive (Acoustic)</span></div>
        <div class="track" data-src="assets/nature_of_daylight.mp3"><span>15 Max Richter · On the Nature of Daylight</span></div>
        <div class="track" data-src="assets/birthplace.mp3"><span>16 Novo Amor · Birthplace </span></div>
      </div>
    </div>

    <div class="record-col">
      <div class="corner-notes">
        <div class="corner-note tl" id="narrative-tl"></div>
        <div class="corner-note tr" id="narrative-tr"></div>
        <div class="corner-note bl" id="narrative-bl"></div>
        <div class="corner-note br" id="narrative-br"></div>
      </div>
    </div>

    <div class="footer">
      <span id="now-playing">NO_MEDIA</span>
      <a href="notes.html" id="exit-btn">Take Notes</a>
    </div>
  </div>

  <script>
    let recordSpin = 0;
    const sidebarWidth = 300;
    const frameBandHeight = 60;

    function setup() {
      // Render the p5 layer behind the html.
      const canvas = createCanvas(windowWidth, windowHeight);
      canvas.parent("record-layer");
      textFont("Helvetica Neue");
      textAlign(CENTER, CENTER);
    }

    function draw() {
      clear();

      // Mirror the CSS frame geometry 
      const frameHeight = height * 0.9;
      const frameWidth = width * 0.94;
      const frameMarginX = (width - frameWidth) / 2;

      const recordZoneLeft = frameMarginX + sidebarWidth;
      const recordZoneRight = width - frameMarginX;
      const centerX = recordZoneLeft + (recordZoneRight - recordZoneLeft) / 2;

      const recordZoneHeight = frameHeight - (frameBandHeight * 2);
      const recordZoneWidth = recordZoneRight - recordZoneLeft;

      const recordDiameter = Math.min(recordZoneWidth, recordZoneHeight) * 0.74;
      const outerGroove = recordDiameter * 0.78;
      const innerGroove = recordDiameter * 0.56;
      const labelSize = recordDiameter * 0.24;
      const centerY = height / 2;

      push();
      translate(centerX, centerY);
      rotate(recordSpin);

      noFill();
      stroke(0);
      strokeWeight(1);
      circle(0, 0, recordDiameter);

      strokeWeight(0.8);
      circle(0, 0, outerGroove);
      circle(0, 0, innerGroove);

      stroke(0, 55);
      strokeWeight(0.55);
      for (let i = 0; i < 4; i++) {
        const t = i / 3;
        const d = lerp(innerGroove * 1.04, outerGroove * 0.98, t);
        circle(0, 0, d);
      }

      noStroke();
      fill(244);
      circle(0, 0, labelSize);

      noFill();
      stroke(0);
      strokeWeight(0.8);
      circle(0, 0, labelSize * 0.96);

      noStroke();
      fill(0);
      const titleSize = Math.max(8, Math.min(14, recordDiameter * 0.028));
      const rpmSize = Math.max(7, Math.min(10, recordDiameter * 0.018));
      textStyle(BOLD);
      textSize(titleSize);
      text("LOST", 0, -labelSize * 0.14);
      textStyle(NORMAL);
      textSize(rpmSize);
      text("33 RPM", 0, labelSize * 0.20);

      noFill();
      stroke(255, 51, 0);
      strokeWeight(1.2);
      arc(
        0,
        0,
        recordDiameter * 0.94,
        recordDiameter * 0.94,
        -0.34,
        -0.08
      );

      stroke(0);
      strokeWeight(1);
      circle(0, 0, 12);
      noStroke();
      fill(0);
      circle(0, 0, 3.2);
      pop();

      const armBaseX = centerX + recordDiameter * 0.56;
      const armBaseY = centerY - recordDiameter * 0.26;
      const armTipX = centerX + recordDiameter * 0.2;
      const armTipY = centerY - recordDiameter * 0.05;

      stroke(0);
      strokeWeight(1.4);
      line(armBaseX, armBaseY, armTipX, armTipY);
      strokeWeight(1);
      circle(armBaseX, armBaseY, 8);
      noStroke();
      fill(0);
      rect(armTipX - 2.6, armTipY - 1.4, 5.2, 2.8);

      recordSpin += 0.0018;
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    const bgm = document.getElementById("audio");
    const cornerNarrativeNodes = [
      document.getElementById("narrative-tl"),
      document.getElementById("narrative-tr"),
      document.getElementById("narrative-bl"),
      document.getElementById("narrative-br")
    ];
    const nowPlaying = document.getElementById("now-playing");
    const timeDisplay = document.getElementById("time-display");
    const overlay = document.getElementById("overlay");
    const crosshairX = document.getElementById("crosshair-x");
    const crosshairY = document.getElementById("crosshair-y");
    const playlistRows = document.querySelectorAll(".track");

    let hasStarted = false;
    let elapsedSeconds = 0;

    const cornerNarrativeLines = [
      "I walked until my legs got tired. The idea didn't show up.",
      "Back in my room, I put my headphones on so the room stops asking.",
      "I keep switching tracks like it's a decision. It's not.",
      "This isn't helping. But maybe writing it down will."
    ];
    const cornerPath = [0, 2, 1, 3, 0, 3, 1, 2];
    const cornerPace = [
      { on: 2600, gap: 900 },
      { on: 3200, gap: 1200 },
      { on: 2800, gap: 1000 },
      { on: 3600, gap: 1100 }
    ];

    function writeCornerNarratives(lines) {
      cornerNarrativeNodes.forEach((el, i) => {
        el.textContent = lines[i];
      });
    }

    function pulseCornerNarratives() {
      cornerNarrativeNodes.forEach((el) => el.classList.add("off"));

      // arrays pulse one narrative at a time.
      let activeCorner = cornerPath[0];
      let orderIndex = 0;
      let rhythmIndex = 0;

      const loop = () => {
        cornerNarrativeNodes[activeCorner].classList.add("off");
        orderIndex = (orderIndex + 1) % cornerPath.length;
        activeCorner = cornerPath[orderIndex];
        cornerNarrativeNodes[activeCorner].classList.remove("off");

        const rhythm = cornerPace[rhythmIndex];
        rhythmIndex = (rhythmIndex + 1) % cornerPace.length;

        setTimeout(() => {
          cornerNarrativeNodes[activeCorner].classList.add("off");
          setTimeout(loop, rhythm.gap);
        }, rhythm.on);
      };

      setTimeout(loop, 500);
    }

    window.addEventListener("mousemove", (e) => {
      crosshairX.style.left = e.clientX + "px";
      crosshairY.style.top = e.clientY + "px";
    });

    playlistRows.forEach((track) => {
      track.addEventListener("click", async () => {
        // Ignore playlist clicks until plahbck
        if (!hasStarted) return;

        bgm.src = track.getAttribute("data-src");

        // Await --> active-row UI aligned with actual audio.
        await bgm.play();

        playlistRows.forEach((t) => t.classList.remove("active"));
        track.classList.add("active");

        nowPlaying.textContent = "PLAYING: " + track.textContent;
      });
    });

    overlay.addEventListener("click", () => {
      // First click closes the gate and boots the first track.
      hasStarted = true;
      overlay.style.display = "none";

      playlistRows[0].click();

      setInterval(() => {
        elapsedSeconds++;
        const m = Math.floor(elapsedSeconds / 60);
        const s = elapsedSeconds % 60;
        timeDisplay.textContent = `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
      }, 1000);
    });

    writeCornerNarratives(cornerNarrativeLines);
    pulseCornerNarratives();
  </script>
</body>
</html>
